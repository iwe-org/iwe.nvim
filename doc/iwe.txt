*iwe.txt*     IWE Neovim Plugin                                    *iwe* *iwe.nvim*

================================================================================
CONTENTS                                                          *iwe-contents*

1. Introduction ............................ |iwe-introduction|
2. Installation ............................ |iwe-installation|
3. Configuration ........................... |iwe-configuration|
4. Commands ................................ |iwe-commands|
5. Key Mappings ............................ |iwe-mappings|
6. Picker Backends ......................... |iwe-picker|
7. Functions ............................... |iwe-functions|
8. Health Checks ........................... |iwe-health|

================================================================================
INTRODUCTION                                                  *iwe-introduction*

IWE (Interactive Writing Environment) is a Neovim plugin designed to enhance
markdown editing workflows with LSP integration and writing-focused features.

The plugin automatically integrates with the `iwes` LSP server when working
with markdown files in directories containing a `.iwe` marker directory.

To start using IWE, navigate to your notes directory and run:
>
    :IWE init
<
This creates a `.iwe` marker directory that identifies the notes root.

Features:~
• LSP integration with iwes server for .iwe projects
• Multi-backend picker support (Telescope, fzf-lua, Snacks, mini.pick)
• Automatic fallback to vim.ui.select for LSP-based pickers
• Markdown-specific editing enhancements
• Configurable key mappings via <Plug> system
• Project initialization with :IWE init
• Health checks and diagnostics

================================================================================
INSTALLATION                                                  *iwe-installation*

The plugin requires the `iwes` LSP server to be installed and available in
your PATH. Create a `.iwe` directory in your project root to enable LSP
functionality.

Optional picker dependencies (at least one recommended):
• `nvim-telescope/telescope.nvim` - Full-featured fuzzy finder
• `ibhagwan/fzf-lua` - Fast fzf-based picker
• `folke/snacks.nvim` - Modern picker with good capabilities
• `echasnovski/mini.pick` - Lightweight picker

For enhanced functionality, the following optional dependencies are supported:
• `render-markdown` plugin for enhanced display
• `gitsigns` plugin for git integration
• `nvim-telescope/telescope-ui-select.nvim` for UI selection
• `xiyaowong/telescope-emoji.nvim` for emoji picker

Note: If no picker is installed, LSP-based features (paths, roots, headers,
blockreferences, backlinks) will fall back to `vim.ui.select`. File and grep
pickers require a fuzzy finder.

================================================================================
CONFIGURATION                                                *iwe-configuration*

The plugin can be configured by calling the setup function:
>lua
    require('iwe').setup({
      lsp = {
        cmd = { "iwes" },
        name = "iwes",
        debounce_text_changes = 500,
        auto_format_on_save = true
      },
      mappings = {
        enable_markdown_mappings = true,
        enable_picker_keybindings = false,
        enable_lsp_keybindings = false,
        enable_preview_keybindings = false,
        leader = "<leader>",
        localleader = "<localleader>"
      },
      picker = {
        backend = "auto",
        fallback_notify = true
      },
      telescope = {
        enabled = true,
        setup_config = true,
        load_extensions = { "ui-select", "emoji" }
      }
    })
<

Configuration Options:~

*g:disable_iwe*         Disable the IWE plugin entirely
*g:loaded_iwe*          Indicates the plugin has been loaded

lsp.cmd                 Command to start LSP server
lsp.name                Name of the LSP server
lsp.debounce_text_changes    Debounce time for text changes (ms)
lsp.auto_format_on_save      Enable automatic formatting on save

mappings.enable_markdown_mappings   Enable core markdown editing key mappings
mappings.enable_picker_keybindings  Enable picker keybindings (gf, gs, ga, etc.)
mappings.enable_lsp_keybindings     Enable IWE-specific LSP keybindings
mappings.leader                     Leader key for mappings
mappings.localleader               Local leader key for mappings

picker.backend          Backend to use: "auto", "telescope", "fzf_lua",
                        "snacks", "mini", "vim_ui", or a custom function
picker.fallback_notify  Notify when falling back to another backend

telescope.enabled               Enable Telescope integration
telescope.setup_config          Auto-setup Telescope configuration
telescope.load_extensions       Extensions to load automatically

================================================================================
COMMANDS                                                          *iwe-commands*

                                                                          *:IWE*
:IWE {subcommand}       Main IWE command with subcommands

    Picker commands (use configured backend):~
    find_files         Find files in project
    paths              Workspace symbols (LSP)
    roots              Namespace symbols (LSP)
    grep               Live grep search
    blockreferences    LSP references (no declaration)
    backlinks          LSP references (with declaration)
    headers            Document symbols (LSP)

    Other commands:~
    init               Initialize IWE project in current directory
    lsp {action}       Control LSP server
                        Actions: start, stop, restart, status, toggle_inlay_hints
    preview {action}   Generate previews using IWE CLI
                        Actions: squash, export, export-headers, export-workspace
    info               Show plugin configuration and status

    Deprecated:~
    telescope {action} (Use direct commands instead)


================================================================================
KEY MAPPINGS                                                      *iwe-mappings*

The plugin provides <Plug> mappings that users can map to their preferred keys.

Markdown Mappings (when enable_markdown_mappings = true):~

In markdown files:
  `-`               <Plug>(iwe-checklist-format)
  `<C-n>`           <Plug>(iwe-link-next)
  `<C-p>`           <Plug>(iwe-link-prev)
  `<CR>`            <Plug>(iwe-lsp-go-to-definition)

Insert mode in markdown files:
  `/d`              <Plug>(iwe-insert-date)
  `/w`              <Plug>(iwe-insert-week)

Visual mode in markdown files:
  `<CR>`            <Plug>(iwe-lsp-link)

Global (Neovide only):
  `<D-l>`           <Plug>(iwe-lsp-start)

Picker keybindings (when enable_picker_keybindings = true):
  `gf`              <Plug>(iwe-picker-find-files)
  `gs`              <Plug>(iwe-picker-paths)
  `ga`              <Plug>(iwe-picker-roots)
  `g/`              <Plug>(iwe-picker-grep)
  `gb`              <Plug>(iwe-picker-blockreferences)
  `gR`              <Plug>(iwe-picker-backlinks)
  `go`              <Plug>(iwe-picker-headers)

IWE LSP keybindings (when enable_lsp_keybindings = true):
  `<leader>h`       <Plug>(iwe-lsp-rewrite-list-section)
  `<leader>l`       <Plug>(iwe-lsp-rewrite-section-list)

Preview keybindings (when enable_preview_keybindings = true):
  `<leader>ps`      <Plug>(iwe-preview-squash)
  `<leader>pe`      <Plug>(iwe-preview-export)
  `<leader>ph`      <Plug>(iwe-preview-export-headers)
  `<leader>pw`      <Plug>(iwe-preview-export-workspace)

Default Neovim LSP keybindings (available when LSP is active):
  `gD`              Go to declaration
  `gd`              Go to definition
  `gi`              Go to implementation
  `gr`              Show references
  `K`               Show hover documentation
  `<C-k>`           Show signature help (insert mode)
  `[d`              Go to previous diagnostic
  `]d`              Go to next diagnostic
  `<leader>ca`      Show code actions
  `<leader>rn`      Rename symbol
  `<leader>f`       Format document

Available <Plug> Mappings:~

*<Plug>(iwe-checklist-format)*     Format current line as checklist item
*<Plug>(iwe-link-next)*            Navigate to next link
*<Plug>(iwe-link-prev)*            Navigate to previous link
*<Plug>(iwe-insert-date)*          Insert current date
*<Plug>(iwe-insert-week)*          Insert current week
*<Plug>(iwe-lsp-start)*            Manually start IWE LSP server

Picker mappings (backend-agnostic):
*<Plug>(iwe-picker-find-files)*    Find files (gf equivalent)
*<Plug>(iwe-picker-paths)*         Workspace symbols - paths (gs equivalent)
*<Plug>(iwe-picker-roots)*         Namespace symbols - roots (ga equivalent)
*<Plug>(iwe-picker-grep)*          Live grep search (g/ equivalent)
*<Plug>(iwe-picker-blockreferences)* LSP references - blockreferences (gb equiv)
*<Plug>(iwe-picker-backlinks)*     LSP references - backlinks (gR equivalent)
*<Plug>(iwe-picker-headers)*       Document symbols - headers (go equivalent)

LSP mappings:
*<Plug>(iwe-lsp-extract-section)*  Extract section (refactor)
*<Plug>(iwe-lsp-inline-reference)* Inline reference (refactor)
*<Plug>(iwe-lsp-rewrite-list-section)* Rewrite list section (refactor)
*<Plug>(iwe-lsp-rewrite-section-list)* Rewrite section list (refactor)
*<Plug>(iwe-lsp-toggle-inlay-hints)* Toggle inlay hints
*<Plug>(iwe-lsp-go-to-definition)* Go to definition
*<Plug>(iwe-lsp-link)*             Create link from selection (visual mode)

Preview mappings:
*<Plug>(iwe-preview-squash)*       Generate squash markdown preview
*<Plug>(iwe-preview-export)*       Generate export graph preview
*<Plug>(iwe-preview-export-headers)* Generate export graph with headers preview
*<Plug>(iwe-preview-export-workspace)* Generate workspace graph preview

Deprecated mappings (still work for backward compatibility):
*<Plug>(iwe-telescope-find-files)* → Use <Plug>(iwe-picker-find-files)
*<Plug>(iwe-telescope-paths)*      → Use <Plug>(iwe-picker-paths)
*<Plug>(iwe-telescope-roots)*      → Use <Plug>(iwe-picker-roots)
*<Plug>(iwe-telescope-grep)*       → Use <Plug>(iwe-picker-grep)
*<Plug>(iwe-telescope-blockreferences)* → Use <Plug>(iwe-picker-blockreferences)
*<Plug>(iwe-telescope-backlinks)*  → Use <Plug>(iwe-picker-backlinks)
*<Plug>(iwe-telescope-headers)*    → Use <Plug>(iwe-picker-headers)

================================================================================
PICKER BACKENDS                                                    *iwe-picker*

The plugin supports multiple picker backends for fuzzy finding functionality.
The backend can be configured via `picker.backend` in setup.

Available backends:~
• "telescope" - nvim-telescope/telescope.nvim (default priority 1)
• "fzf_lua"   - ibhagwan/fzf-lua (priority 2)
• "snacks"    - folke/snacks.nvim (priority 3)
• "mini"      - echasnovski/mini.pick (priority 4)
• "vim_ui"    - vim.ui.select fallback (always available)
• "auto"      - Automatically detect best available (default)

Custom backend:~

You can provide a custom function as the backend:
>lua
    require('iwe').setup({
      picker = {
        backend = function(action, opts)
          -- action: "find_files", "grep", "lsp_workspace_symbols",
          --         "lsp_document_symbols", "lsp_references"
          -- opts: table with action-specific options
          -- Implement your custom picker logic here
        end
      }
    })
<

Picker API:~

The picker module can be used directly:
>lua
    local picker = require('iwe.picker')

    picker.find_files()        -- File picker
    picker.grep()              -- Live grep
    picker.paths()             -- Workspace symbols
    picker.roots()             -- Namespace symbols
    picker.headers()           -- Document symbols
    picker.blockreferences()   -- LSP references (no declaration)
    picker.backlinks()         -- LSP references (with declaration)

    picker.is_available()      -- Check if any picker available
    picker.get_backend()       -- Get current backend name
    picker.list_backends()     -- List all available backends
<

Fallback behavior:~

When using `vim.ui.select` as fallback:
• LSP-based pickers work via direct LSP calls
• File pickers show a message suggesting `:edit` or fuzzy finder installation
• Grep shows a message suggesting `:vimgrep` or fuzzy finder installation

================================================================================
FUNCTIONS                                                        *iwe-functions*

require('iwe').setup({opts})                                    *iwe.setup()*
    Configure the IWE plugin with user options.

require('iwe').get_project_root()                      *iwe.get_project_root()*
    Get the current IWE project root directory (containing .iwe marker).

require('iwe').is_in_project()                            *iwe.is_in_project()*
    Check if current buffer/directory is in an IWE project.

require('iwe').start_lsp({bufnr})                            *iwe.start_lsp()*
    Start the IWE LSP server for the specified buffer.

require('iwe').lsp_available()                            *iwe.lsp_available()*
    Check if the iwes LSP server is available in PATH.

require('iwe').get_config()                                *iwe.get_config()*
    Get the current plugin configuration.

Picker functions:~

require('iwe.picker').find_files()                    *iwe.picker.find_files*
    Launch file picker (gf equivalent).

require('iwe.picker').paths()                              *iwe.picker.paths*
    Launch workspace symbols picker - paths (gs equivalent).

require('iwe.picker').roots()                              *iwe.picker.roots*
    Launch namespace symbols picker - roots (ga equivalent).

require('iwe.picker').grep()                                *iwe.picker.grep*
    Launch live grep picker (g/ equivalent).

require('iwe.picker').blockreferences()          *iwe.picker.blockreferences*
    Launch LSP references picker - blockreferences (gb equivalent).

require('iwe.picker').backlinks()                      *iwe.picker.backlinks*
    Launch LSP references picker - backlinks (gR equivalent).

require('iwe.picker').headers()                          *iwe.picker.headers*
    Launch document symbols picker - headers (go equivalent).

require('iwe.picker').is_available()                *iwe.picker.is_available*
    Check if any picker backend is available.

require('iwe.picker').get_backend()                  *iwe.picker.get_backend*
    Get the name of the current picker backend.

require('iwe.picker').list_backends()              *iwe.picker.list_backends*
    List all available picker backends.

Preview functions:~

require('iwe.preview').generate_squash_preview()      *iwe.preview.squash*
    Generate squashed markdown preview using iwe CLI.

require('iwe.preview').generate_export_preview()      *iwe.preview.export*
    Generate basic DOT graph as SVG using iwe CLI.

require('iwe.preview').generate_export_headers_preview() *iwe.preview.export-headers*
    Generate DOT graph with headers as SVG using iwe CLI.

require('iwe.preview').generate_export_workspace_preview() *iwe.preview.export-workspace*
    Generate full workspace graph as SVG using iwe CLI.

Deprecated (use iwe.picker instead):~

require('iwe.telescope').pickers.find_files()        *iwe.telescope.pickers*
    Deprecated. Use require('iwe.picker').find_files() instead.


================================================================================
HEALTH CHECKS                                                      *iwe-health*

Use |:checkhealth| to diagnose plugin issues:
>
    :checkhealth iwe
<

The health check verifies:
• iwes LSP server availability
• .iwe project marker existence
• Configuration validity
• Picker backend availability and status
• Optional dependencies (render-markdown, gitsigns)
• Preview functionality (iwe CLI and Graphviz)
• Current LSP server status

================================================================================
vim:tw=78:ts=8:ft=help:norl:
